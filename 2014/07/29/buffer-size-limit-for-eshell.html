
<!DOCTYPE html>
<html>
    <meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=0">
   <link rel="stylesheet" href="/assets/themes//css/bootstrap.min.css" media="screen and (min-device-width: 700px)"/>
   <link rel="stylesheet" href="/assets/themes//css/pygments.css" />
   <link rel="stylesheet" href="/assets/themes//css/style.css" media="screen"/>
   <link rel="stylesheet" href="/assets/themes//css/mobile.css" media="handheld"/>
   <script type="text/javascript" charset="utf-8" async="" src="/assets/themes//js/common.js"></script>

   <header>
       <meta charset="utf-8">
       <meta charset="UTF-8"/>
       
       
       <title>Automatically cleanup the buffer for Eshell | Yukang's Page</title>
       

       
       <meta name="description" content="">
       
       <meta name="author" content="Yukang">

       <script type="text/javascript"
               href="/assets/themes/twitter/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
       </script>

       <!-- Le fav and touch icons -->
       <link rel="shortcut icon" href="/images/favicon.ico">
       <div class="navbar" id="navbar">
           <div class="navbar-inner">
        <div class="container">
          <a class="brand" id="brand" href="/">Yukang's Page</a>
          <ul class="nav" id="navbar-inner">
            
            
            


  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive">归档</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags">标签</a></li>
      	
      
    
  




            <li class="divider-vertical"></li>
            <li><a href="/about.html">关于</a></li>
            <li><a href="/links.html">链接</a></li>
            <li><a href="/atom.xml">订阅</a></li>
          </ul>
          <span class="pull-right slogan"> Don't Panic </span>
        </div>
      </div>
    </div>
  </header>

  <body>
      <div class="container">
      <div class="content" >
        

<div class="row post">
    <div class="span8">
        <h1 class="title">Automatically cleanup the buffer for Eshell</h1>

            <p>Keep writing some simple thing in English, for I will have less chance for writing English words in daily working.</p>

<p>I will always run eshell for shell tasks, because this is really like the normal buffer in Emacs, so all the command for Emacs will keep working for this buffer. This is convenient for some actions.</p>

<p>The problem annoying me is that if the size of buffer for eshell is too big, Emacs will gets more and more slow. Emacs essentially is a sole process program. So I have some digg and written a trivial elisp code like this solved the problem.</p>
<div class="highlight"><pre><code class="language-lisp" data-lang="lisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">clear-and-send-input</span><span class="p">()</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">count-lines</span> <span class="mi">1</span> <span class="p">(</span><span class="nv">point</span><span class="p">))</span> <span class="mi">800</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">inhibit-read-only</span> <span class="no">t</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">message</span> <span class="s">&quot;Clear the eshell now !&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">erase-buffer</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">eshell-send-input</span><span class="p">))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;eshell-mode-hook</span>
      <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
      <span class="p">(</span><span class="nv">local-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&quot;&lt;return&gt;&quot;</span><span class="p">)</span> <span class="ss">&#39;clear-and-send-input</span><span class="p">)))</span>
</code></pre></div>
<p>clear-and-send-input is a wrapper for eshell-send-input, I set the maximal number of eshell buffer to 800, and I bind this function to <return>, so every time if the buffer size is too big, this wrapper will automatically clean up the buffer.</p>

<p>And yesterday I found this article <a href="https://github.com/redguardtoo/mastering-emacs-in-one-year-guide">Mastering Emacs in one year guide</a>is really thought-provoking, Hope this may help you.</p>

            
            <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">          
                <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
                    <span>打赏</span>
                </button>
                <div id="QR" style="display: none;">      
                    <div id="wechat" style="display: inline-block">
                        <a href="/images/yukang_wechat.jpg" rel="group" ><img id="wechat_qr" src="/images/yukang_wechat.jpg" style="width: 255px;height:235px;"  alt="Yukang WeChat Pay"></a>
                    </div>
                </div>
            </div>
            
            <ul class="pager" id="page-nav">
                
                <li class="next"><a href="/2014/06/28/scheme-go.html" title="A mini Scheme interpreter written in Go">A mini Scheme interpreter written in Go&rarr;</a></li>
                

                
                <li class="previous"><a href="/2014/08/01/install-server.html" title="折腾服务器">&larr; 折腾服务器</a></li>
                
            </ul>

            <!--*********************************************************-->
            <!--****** 看见这个时候，删掉下面的统计代码啊~ ******-->
            <!--*********************************************************-->
            <div id="disqus_thread"></div>
            <script>

            /**
            *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
            *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
            /*
            var disqus_config = function () {
            this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
            this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
            };
            */
            (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = 'https://yukang.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>


        <div class="span4 sidebar">
            
            <h4 class="date">日期：<span>29 July 2014</span></h4>
            

            
            <h4>标签</h4>
            <ul class="tag_box">
                
                


  
     
    	<li><a href="/tags.html#Emacs-ref">Emacs <span>8</span></a></li>
     
    	<li><a href="/tags.html#shell-ref">shell <span>1</span></a></li>
    
  



            </ul>
            

            <div class="violet-aside-post">
                <h4 class="v-section-tit">最近</h4>
                <ul>
                    
                    <li class="v-aside-li">
                        <a href="/2017/07/22/kong-intro-5.html" title="Kong源码分析: 事件" rel="bookmark">Kong源码分析: 事件</a>
                    </li>
                    
                    <li class="v-aside-li">
                        <a href="/2017/07/22/kong-intro-4.html" title="Kong源码分析: 缓存" rel="bookmark">Kong源码分析: 缓存</a>
                    </li>
                    
                    <li class="v-aside-li">
                        <a href="/2017/07/16/kong-intro-3.html" title="Kong源码分析: 插件" rel="bookmark">Kong源码分析: 插件</a>
                    </li>
                    
                    <li class="v-aside-li">
                        <a href="/2017/07/07/kong-intro-2.html" title="Kong源码分析: 启动" rel="bookmark">Kong源码分析: 启动</a>
                    </li>
                    
                    <li class="v-aside-li">
                        <a href="/2017/07/02/kong-intro.html" title="Kong源码分析" rel="bookmark">Kong源码分析</a>
                    </li>
                    
                    <li class="v-aside-li">
                        <a href="/2017/06/27/recent-reading-list.html" title="小说推荐" rel="bookmark">小说推荐</a>
                    </li>
                    
                    <li class="v-aside-li">
                        <a href="/2017/05/22/try-on-openresty.html" title="OpenResty使用总结" rel="bookmark">OpenResty使用总结</a>
                    </li>
                    
                    <li class="v-aside-li">
                        <a href="/2017/04/09/rubytt-cont.html" title="rubytt 续" rel="bookmark">rubytt 续</a>
                    </li>
                    
                    <li class="v-aside-li">
                        <a href="/2017/01/24/disease-of-programmer.html" title="程序员病" rel="bookmark">程序员病</a>
                    </li>
                    
                    <li class="v-aside-li">
                        <a href="/2016/12/27/rubytt.html" title="Ruby 程序的静态分析: rubytt" rel="bookmark">Ruby 程序的静态分析: rubytt</a>
                    </li>
                    
                    <li class="v-aside-li">
                        <a href="/2016/12/11/qianlong-history.html" title="读《饥饿的盛世》" rel="bookmark">读《饥饿的盛世》</a>
                    </li>
                    
                    <li class="v-aside-li">
                        <a href="/2016/11/30/nginx-traffic-limit.html" title="Nginx限流" rel="bookmark">Nginx限流</a>
                    </li>
                    
                    <li class="v-aside-li">
                        <a href="/2016/08/09/dao-yu-ju.html" title="菊与刀" rel="bookmark">菊与刀</a>
                    </li>
                    
                    <li class="v-aside-li">
                        <a href="/2016/07/22/capistrano-syntax-check-for-rails.html" title="Add syntax check for Capistrano" rel="bookmark">Add syntax check for Capistrano</a>
                    </li>
                    
                    <li class="v-aside-li">
                        <a href="/2016/07/08/fun-on-hackerrank.html" title="刷刷算法和 OJ" rel="bookmark">刷刷算法和 OJ</a>
                    </li>
                    
                </ul>
            </div>

            <div class="violet-aside-post">
                <h4 class="v-section-tit">页面</h4>
                <nav class="nav">
                    <ul>
                        <li><a href="/archive.html" >归档</a></li>
                        <li><a href="/tags.html">标签</a></li>
                        <li><a href="/links.html" >链接</a></li>
                        <li><a href="/about.html" >关于</a></li>
                        <li><a href="/atom.xml" target="_blank" >RSS</a></li>
                    </ul>
                </nav>
            </div>
        </div>
</div>




      </div>

      <footer id="footer">
        <p>&copy; <a href="mailto:moorekang@gmail.com">Yukang</a> 2016.
          Proudly powered by <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll</a>
        </p>

      </footer>
    </div> <!-- /container -->

    <!--*********************************************************-->
    <!--****** 看见这个时候，删掉下面的统计代码啊~ ******-->
    <!--*********************************************************-->
    
    <script>
     var _hmt = _hmt || [];
     (function() {
         var hm = document.createElement("script");
         hm.src = "//hm.baidu.com/hm.js?ba1315646a61cc7bd6f574a6b5221640";
         var s = document.getElementsByTagName("script")[0]; 
         s.parentNode.insertBefore(hm, s);
     })();

     (function() {
         var width = document.body.offsetWidth;
         if(width < 701) {
             var nav = document.getElementById("navbar-inner");
             nav.remove();
         };
     })();
    </script>

    <!--*********************************************************-->

  </body>
  
</html>

