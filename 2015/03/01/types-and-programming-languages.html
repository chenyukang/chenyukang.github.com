<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="yanm1ng&#39;s blog">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      Types and Programming Languages (1) | Yukang&#39;s Page
    
  </title>
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/gitment.css">
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
  <script src="/js/qrious.js"></script>
<script src="/js/gitment.js"></script>
</head>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>Yukang's Page</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>Types and Programming Languages (1)</h2>
  <p class="post-date">2015-03-01</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body">
  <article class="post-article">
    <section class="markdown-content"><p>最近掉进另外一个PL的坑里面，就是想读一下<a href="http://www.cis.upenn.edu/~bcpierce/tapl/" target="_blank" rel="external">这本书</a>，顺便继续熟悉一下Ocaml。下面的记录是阅读过程中的一些摘录和理解。</p>
<p>1-2章是数学预备部分，理论部分有些地方比较难懂，主要是一些数学符号看久了眼花。<br>解释器的实现大多只用看syntax.ml和core.ml，就是语法和具体eval，typeof函数。</p>
<h2 id="Untyped-Systems"><a href="#Untyped-Systems" class="headerlink" title="Untyped Systems"></a>Untyped Systems</h2><p>arith是一个无类型的解释器，是后面所有章节的基础。printtm_Term用了Format模块来格式化打印。</p>
<h2 id="The-Untyped-Lambda-Calculus"><a href="#The-Untyped-Lambda-Calculus" class="headerlink" title="The Untyped Lambda-Calculus"></a>The Untyped Lambda-Calculus</h2><p>浅显易懂的Lambda-Calculus解释，同时列举了一些lambda calculus扩展其他语言部分的例子。</p>
<h2 id="An-ML-Implementation-of-the-Lambda-Calculus"><a href="#An-ML-Implementation-of-the-Lambda-Calculus" class="headerlink" title="An ML Implementation of the Lambda-Calculus"></a>An ML Implementation of the Lambda-Calculus</h2><p>shifting和substitution的实现挺难看懂的，本质上是把context里面的变量用index来替换，处理变量查找的一种实现而已。eval部分是非常地简洁，我觉得ML系的语法看起来比Scheme都舒服紧凑。</p>
<pre><code>Just because you’ve implemented something doesn’t mean you understand it.
                                                    —Brian Cantwell Smith
</code></pre><p>说起来全是泪，用这种函数式的编程语言来解释自己确实比较简单，但现实往往不是这样。语言能比较容易地实现自己至少可以表明语言的内核挺小，一个语言能实现bootstrap是成熟的一个表现。Rust的实现最初是用Ocaml写的，然后编译出一个Rust的编译器，然后用上一版本的Rust再重新实现Rust编译器。</p>
<h2 id="Typed-Arithmetic-Expressions"><a href="#Typed-Arithmetic-Expressions" class="headerlink" title="Typed Arithmetic Expressions"></a>Typed Arithmetic Expressions</h2><p>tyarith是最简单的带类型的解释器，有bool和Nat类型。</p>
<pre><code>Progress: A well-typed term is not stuck (either it is a value or it can take a step according to the evaluation rules).
Preservation: If a well-typed term takes a step of evaluation, then the resulting term is also well typed
</code></pre><p>These properties together tell us that a well-typed term can never reach a stuck state during evaluation.</p>
<p>Safety = Progress + Preservation</p>
<h2 id="Simply-Typed-Lambda-Calculus"><a href="#Simply-Typed-Lambda-Calculus" class="headerlink" title="Simply Typed Lambda-Calculus"></a>Simply Typed Lambda-Calculus</h2><pre><code>In general, languages in which type annotations in terms are used to help guide the typechecker are called explicitly typed. Languages in which we ask the typechecker to infer or reconstruct this information are called implicitly typed.

Well-typed programs cannot “go wrong.” —Robin Milner (1978)
</code></pre><h2 id="An-ML-Implementation-of-Simple-Types"><a href="#An-ML-Implementation-of-Simple-Types" class="headerlink" title="An ML Implementation of Simple Types"></a>An ML Implementation of Simple Types</h2><p>simplebool是一个只有bool类型的解释器，但是加上了函数。typeof挺简单，主要是函数这里注意处理形参和实参:</p>
<figure class="highlight ocaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">| <span class="type">TmAbs</span>(fi,x,tyT1,t2) -&gt;</div><div class="line">    <span class="keyword">let</span> ctx' = addbinding ctx x (<span class="type">VarBind</span>(tyT1)) <span class="keyword">in</span></div><div class="line">    <span class="keyword">let</span> tyT2 = typeof ctx' t2 <span class="keyword">in</span></div><div class="line">    <span class="type">TyArr</span>(tyT1, tyT2)</div><div class="line">| <span class="type">TmApp</span>(fi,t1,t2) -&gt;</div><div class="line">    <span class="keyword">let</span> tyT1 = typeof ctx t1 <span class="keyword">in</span></div><div class="line">    <span class="keyword">let</span> tyT2 = typeof ctx t2 <span class="keyword">in</span></div><div class="line">    (<span class="keyword">match</span> tyT1 <span class="keyword">with</span></div><div class="line">        <span class="type">TyArr</span>(tyT11, tyT12) -&gt;</div><div class="line">          <span class="keyword">if</span> (=) tyT2 tyT11 <span class="keyword">then</span> tyT12</div><div class="line">          <span class="keyword">else</span> error fi <span class="string">"parameter type mismatch"</span></div><div class="line">      | _ -&gt; error fi <span class="string">"arrow type expected"</span>)</div></pre></td></tr></table></figure>
<p>if的判断部分必须为bool，而且两个分支必须为同一类型:</p>
<figure class="highlight ocaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">| <span class="type">TmIf</span>(fi,t1,t2,t3) -&gt;</div><div class="line">   <span class="keyword">if</span> (=) (typeof ctx t1) <span class="type">TyBool</span> <span class="keyword">then</span></div><div class="line">     <span class="keyword">let</span> tyT2 = typeof ctx t2 <span class="keyword">in</span></div><div class="line">     <span class="keyword">if</span> (=) tyT2 (typeof ctx t3) <span class="keyword">then</span> tyT2</div><div class="line">     <span class="keyword">else</span> error fi <span class="string">"arms of conditional have different types"</span></div><div class="line">     <span class="keyword">else</span> error fi <span class="string">"guard of conditional not a boolean"</span></div></pre></td></tr></table></figure>
<h2 id="Simple-Extensions"><a href="#Simple-Extensions" class="headerlink" title="Simple Extensions"></a>Simple Extensions</h2><p>在上一章的基础上，加上各种Drived Form。</p>
<p>####Sequencing<br>是多个表达式串，这在有副作用的语言里面很常见。另外也可以把t1;t2理解为(λx:Unit.t2) t1。</p>
<p>####Wildcards<br>如何翻译好，意思就是无用形参可以不指定名字。</p>
<p>####Ascription<br>是指类型缩写(或者昵名)，C++里面的typedef，和Rust里面的usize as U都是。这个的好处在于文档和接口更清晰，如果函数的参数可以是函数，类型加进以后语法看起来就比较繁琐了，用类型缩写更清晰。typechecker的时候当然需要展开来进行。ascription和casting也有一定关系。</p>
<p>增加各种简单的基础类型，比如String，还有Pairs，Tuple，Record， Sum，Enum，List。支持一种类型除了一个新类型名字外，其evaluation rules和type rules也要明确。这里的datatypes是按照Ocaml的语法来说明的。</p>
<p>因为加上了好多种类型，fullsimple这个解释器复杂多了。</p>
<p>####Type Dynamic</p>
<pre><code>Even in statically typed languages, there is often the need to deal with data whose type cannot be determined at compile time. This occurs in particular when the lifetime of the data spans multiple machines or many runs of the compiler—when, for example, the data is stored in an external file system or database, or communicated across a network. To handle such situations safely, many languages offer facilities for inspecting the types of values at run time.
</code></pre><p>####General Recursion<br>typed lambda-calculus加上fix combinator就是一门极小的但是是full abstraction的语言。Ocaml里面的letrec可以用来定义递归函数。fix point的概念需要继续理解。</p>
</section>
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#Programming" >
    <span class="tag-code">Programming</span>
  </a>

  <a href="/tags#PL" >
    <span class="tag-code">PL</span>
  </a>

  <a href="/tags#OCaml" >
    <span class="tag-code">OCaml</span>
  </a>

      </div>
    
    <div class="money-like">
      <div class="reward-btn">
        赏
        <span class="money-code">
          <span class="wechat-code">
            <div class="code-image"></div>
            <b>使用微信打赏</b>
          </span>
        </span>
      </div>
      <p class="notice">若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏</p>
    </div>
    <div class="qrcode">
      <canvas id="share-qrcode"></canvas>
      <p class="notice">扫描二维码，分享此文章</p>
    </div>
    
      <div id="comments"></div>
    
  </article>
</main>

<script>
  (function () {
    var url = 'http://cyukang.com/2015/03/01/types-and-programming-languages.html';
    var banner = ''
    if (banner) {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png') 
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      var imageW = $(this).width()
      var imageH = $(this).height()
      
      var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
      zoom = zoom < 1 ? 1 : zoom
      zoom = zoom > 2 ? 2 : zoom
      var transY = (($(window).height() - imageH) / 2).toFixed(2)

      $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
      $('.image-view-wrap').addClass('wrap-active')
      $('.image-view-wrap img').css({
        'width': `${imageW}`,
        'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
      })
      $('html').css('overflow', 'hidden')

      $('.image-view-wrap').on('click', function() {
        $(this).remove()
        $('html').attr('style', '')
      })
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

    // gitment
    var gitmentConfig = "chenyukang";
    if (gitmentConfig != "undefined") {
      var gitment = new Gitment({
        id: "Types and Programming Languages (1)",
        owner: "chenyukang",
        repo: "chenyukang.github.io",
        oauth: {
          client_id: "ccc45f6f66c60934e41a",
          client_secret: "84f77bd89f8dfbd1bf77dcd696f2a66b1afe7587"
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2017 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a href="https://github.com/yanm1ng">yanm1ng</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine == 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script>
    var _baId = 'ba1315646a61cc7bd6f574a6b5221640';
    // Originial
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?" + _baId;
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

<script src="/js/script.js"></script>
  </body>
</html>